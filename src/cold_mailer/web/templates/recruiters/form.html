{% extends "base.html" %}

{% block title %}{% if action == 'edit' %}Edit{% else %}Add{% endif %} Recruiter - Cold Mailer{% endblock %}

{% block header %}
<header class="bg-white shadow">
    <div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8">
        <h1 class="text-3xl font-bold tracking-tight text-gray-900">
            {% if action == 'edit' %}Edit Recruiter{% else %}Add New Recruiter{% endif %}
        </h1>
    </div>
</header>
{% endblock %}

{% block content %}
<div class="px-4 sm:px-0" x-data="{ customFields: {{ (recruiter.custom_fields if recruiter else form_data.get('custom_fields', {}) if form_data is defined else {})|tojson|safe }}, newFieldKey: '', newFieldValue: '' }">
    <div class="max-w-2xl mx-auto">
        <form method="POST" action="{% if action == 'edit' %}/recruiters/{{ recruiter.id }}/edit{% else %}/recruiters/add{% endif %}" class="space-y-6 bg-white shadow rounded-lg p-6">

            {% if errors.get('general') %}
            <div class="rounded-md bg-red-50 p-4">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-red-700">{{ errors.general }}</p>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Email -->
            <div>
                <label for="email" class="block text-sm font-medium text-gray-700">Email <span class="text-red-500">*</span></label>
                <input type="email" name="email" id="email" required
                    value="{{ recruiter.email if recruiter else form_data.email if form_data is defined else '' }}"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm {% if errors.get('email') %}border-red-300{% endif %}"
                    placeholder="recruiter@company.com">
                {% if errors.get('email') %}
                <p class="mt-1 text-sm text-red-600">{{ errors.email }}</p>
                {% endif %}
            </div>

            <!-- Name Row -->
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                <div>
                    <label for="first_name" class="block text-sm font-medium text-gray-700">First Name <span class="text-red-500">*</span></label>
                    <input type="text" name="first_name" id="first_name" required
                        value="{{ recruiter.first_name if recruiter else form_data.first_name if form_data is defined else '' }}"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="last_name" class="block text-sm font-medium text-gray-700">Last Name</label>
                    <input type="text" name="last_name" id="last_name"
                        value="{{ recruiter.last_name if recruiter else form_data.last_name if form_data is defined else '' }}"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                </div>
            </div>

            <!-- Company -->
            <div>
                <label for="company" class="block text-sm font-medium text-gray-700">Company <span class="text-red-500">*</span></label>
                <input type="text" name="company" id="company" required
                    value="{{ recruiter.company if recruiter else form_data.company if form_data is defined else '' }}"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>

            <!-- Title & Job Title Row -->
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                <div>
                    <label for="title" class="block text-sm font-medium text-gray-700">Title (Mr./Ms./Dr.)</label>
                    <select name="title" id="title"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <option value="">-- None --</option>
                        <option value="Mr." {% if (recruiter and recruiter.title == 'Mr.') or (form_data is defined and form_data.title == 'Mr.') %}selected{% endif %}>Mr.</option>
                        <option value="Ms." {% if (recruiter and recruiter.title == 'Ms.') or (form_data is defined and form_data.title == 'Ms.') %}selected{% endif %}>Ms.</option>
                        <option value="Mrs." {% if (recruiter and recruiter.title == 'Mrs.') or (form_data is defined and form_data.title == 'Mrs.') %}selected{% endif %}>Mrs.</option>
                        <option value="Dr." {% if (recruiter and recruiter.title == 'Dr.') or (form_data is defined and form_data.title == 'Dr.') %}selected{% endif %}>Dr.</option>
                        <option value="Prof." {% if (recruiter and recruiter.title == 'Prof.') or (form_data is defined and form_data.title == 'Prof.') %}selected{% endif %}>Prof.</option>
                    </select>
                </div>
                <div>
                    <label for="job_title" class="block text-sm font-medium text-gray-700">Job Title (applying for)</label>
                    <input type="text" name="job_title" id="job_title"
                        value="{{ recruiter.job_title if recruiter else form_data.job_title if form_data is defined else '' }}"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
                        placeholder="Software Engineer">
                </div>
            </div>

            <!-- Department -->
            <div>
                <label for="department" class="block text-sm font-medium text-gray-700">Department</label>
                <input type="text" name="department" id="department"
                    value="{{ recruiter.department if recruiter else form_data.department if form_data is defined else '' }}"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
                    placeholder="Engineering">
            </div>

            <!-- Greeting Style -->
            <div>
                <label for="greeting_style" class="block text-sm font-medium text-gray-700">Greeting Style</label>
                <select name="greeting_style" id="greeting_style"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    <option value="formal" {% if (recruiter and recruiter.greeting_style == 'formal') or (form_data is defined and form_data.greeting_style == 'formal') %}selected{% endif %}>Formal (Dear Mr./Ms. LastName)</option>
                    <option value="semi_formal" {% if (recruiter and recruiter.greeting_style == 'semi_formal') or (form_data is defined and form_data.greeting_style == 'semi_formal') or (not recruiter and form_data is not defined) %}selected{% endif %}>Semi-Formal (Dear FirstName)</option>
                    <option value="casual" {% if (recruiter and recruiter.greeting_style == 'casual') or (form_data is defined and form_data.greeting_style == 'casual') %}selected{% endif %}>Casual (Hi FirstName)</option>
                    <option value="professional" {% if (recruiter and recruiter.greeting_style == 'professional') or (form_data is defined and form_data.greeting_style == 'professional') %}selected{% endif %}>Professional (Hello Mr./Ms. LastName)</option>
                </select>
            </div>

            {% if action == 'edit' %}
            <!-- Status (only for edit) -->
            <div>
                <label for="status" class="block text-sm font-medium text-gray-700">Status</label>
                <select name="status" id="status"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    <option value="pending" {% if recruiter and recruiter.status == 'pending' %}selected{% endif %}>Pending</option>
                    <option value="sent" {% if recruiter and recruiter.status == 'sent' %}selected{% endif %}>Sent</option>
                    <option value="replied" {% if recruiter and recruiter.status == 'replied' %}selected{% endif %}>Replied</option>
                    <option value="bounced" {% if recruiter and recruiter.status == 'bounced' %}selected{% endif %}>Bounced</option>
                </select>
            </div>
            {% endif %}

            <!-- Custom Fields -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Custom Fields</label>
                <div class="space-y-2">
                    <!-- Existing custom fields -->
                    <template x-for="(value, key) in customFields" :key="key">
                        <div class="flex gap-2 items-center">
                            <input type="text" name="custom_field_keys" x-bind:value="key" readonly
                                class="flex-1 rounded-md border-gray-300 bg-gray-50 shadow-sm sm:text-sm">
                            <input type="text" name="custom_field_values" x-model="customFields[key]"
                                class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <button type="button" @click="delete customFields[key]" class="text-red-600 hover:text-red-900">
                                <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                    </template>

                    <!-- Add new field -->
                    <div class="flex gap-2 items-center">
                        <input type="text" x-model="newFieldKey" placeholder="Key"
                            class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <input type="text" x-model="newFieldValue" placeholder="Value"
                            class="flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <button type="button" @click="if(newFieldKey.trim() && newFieldValue.trim()) { customFields[newFieldKey.trim()] = newFieldValue.trim(); newFieldKey = ''; newFieldValue = ''; }"
                            class="text-indigo-600 hover:text-indigo-900">
                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.75-11.25a.75.75 0 00-1.5 0v2.5h-2.5a.75.75 0 000 1.5h2.5v2.5a.75.75 0 001.5 0v-2.5h2.5a.75.75 0 000-1.5h-2.5v-2.5z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
                <p class="mt-1 text-xs text-gray-500">Custom fields can be used in email templates as {{ '{{ custom.key }}' }}</p>
            </div>

            <!-- Form Actions -->
            <div class="flex justify-end gap-3 pt-4 border-t">
                <a href="/recruiters" class="rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                    Cancel
                </a>
                <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500">
                    {% if action == 'edit' %}Update{% else %}Add{% endif %} Recruiter
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
